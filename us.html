
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reporte RIPS - Captura de Datos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f9fafb;
    margin: 0; padding: 20px;
    color: #333;
  }
  h1, h2 {
    text-align: center;
    color: #005b96;
  }
  form {
    max-width: 900px;
    margin: 0 auto;
    background: #fff;
    padding: 25px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    border-radius: 8px;
  }
  label {
    display: block;
    margin: 15px 0 5px 0;
    font-weight: bold;
  }
  input[type="text"],
  input[type="date"],
  input[type="number"],
  select,
  textarea {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #bbb;
    border-radius: 4px;
    font-size: 1em;
    box-sizing: border-box;
  }
  textarea {
    resize: vertical;
  }
  button, #exportBtn, #limpiarBtn {
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 1.1em;
    cursor: pointer;
    border-radius: 5px;
    margin-top: 20px;
    display: block;
    width: 100%;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
    transition: background-color 0.3s ease;
  }
  button:hover, #exportBtn:hover, #limpiarBtn:hover {
    filter: brightness(85%);
  }
  #exportBtn {
    background-color: #005b96;
  }
  #limpiarBtn {
    background-color: #c82333;
  }
  #tablaRegistros {
    max-width: 900px;
    margin: 30px auto;
    display: none;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    overflow-x: auto;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    min-width: 1100px;
  }
  th, td {
    padding: 8px 10px;
    border: 1px solid #bbb;
    text-align: left;
    white-space: nowrap;
  }
  th {
    background-color: #005b96;
    color: white;
  }
  #mensajeExito {
    max-width: 900px;
    margin: 10px auto 0 auto;
    padding: 12px;
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
    border-radius: 5px;
    display: none;
    text-align: center;
  }
  .resumen {
    margin-top: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Datos del usuario</h1>

<form id="ripsForm" onsubmit="return generarReporte(event)">
  <!-- Campos de tu formulario -->
  <label for="tipoIdentificacion">Tipo de Identificación del Usuario:</label>
  <select id="tipoIdentificacion" name="tipoIdentificacion" required>
    <option value="">-- Seleccione --</option>
    <option value="CC">Cédula de Ciudadanía</option>
    <option value="TI">Tarjeta de Identidad</option>
    <option value="CE">Cédula de Extranjería</option>
    <option value="PAS">Pasaporte</option>
    <option value="OTRO">Otro</option>
  </select>

  <label for="numIdSistema">Número de Identificación del Usuario del Sistema:</label>
  <input type="text" id="numIdSistema" name="numIdSistema" required maxlength="30" />

  <label for="codigoEntidad">Código Entidad Administradora:</label>
  <input type="text" id="codigoEntidad" name="codigoEntidad" required maxlength="20" />

  <label for="tipoUsuario">Tipo de Usuario:</label>
  <select id="tipoUsuario" name="tipoUsuario" required>
    <option value="">-- Seleccione --</option>
    <option value="Afiliado">Afiliado</option>
    <option value="Beneficiario">Beneficiario</option>
    <option value="Otro">Otro</option>
  </select>

  <label for="primerApellido">Primer Apellido del Usuario:</label>
  <input type="text" id="primerApellido" name="primerApellido" required maxlength="50" />

  <label for="segundoApellido">Segundo Apellido del Usuario:</label>
  <input type="text" id="segundoApellido" name="segundoApellido" maxlength="50" />

  <label for="primerNombre">Primer Nombre del Usuario:</label>
  <input type="text" id="primerNombre" name="primerNombre" required maxlength="50" />

  <label for="segundoNombre">Segundo Nombre del Usuario:</label>
  <input type="text" id="segundoNombre" name="segundoNombre" maxlength="50" />

  <label for="edad">Edad (en número):</label>
  <input type="number" id="edad" name="edad" required min="0" max="120" />

  <label for="unidadEdad">Unidad de Medida de la Edad:</label>
  <select id="unidadEdad" name="unidadEdad" required>
    <option value="">-- Seleccione --</option>
    <option value="Años">Años</option>
    <option value="Meses">Meses</option>
    <option value="Días">Días</option>
  </select>

  <label for="sexo">Sexo:</label>
  <select id="sexo" name="sexo" required>
    <option value="">-- Seleccione --</option>
    <option value="M">Masculino</option>
    <option value="F">Femenino</option>
    <option value="O">Otro</option>
  </select>

  <label for="codigoDepartamento">Código del Departamento:</label>
  <input type="text" id="codigoDepartamento" name="codigoDepartamento" maxlength="10" />

  <label for="codigoMunicipio">Código del Municipio:</label>
  <input type="text" id="codigoMunicipio" name="codigoMunicipio" maxlength="10" />

  <label for="zonaResidencia">Zona de Residencia:</label>
  <select id="zonaResidencia" name="zonaResidencia" required>
    <option value="">-- Seleccione --</option>
    <option value="Urbana">Urbana</option>
    <option value="Rural">Rural</option>
    <option value="Otro">Otro</option>
  </select>

  <label for="numAfiliacion">Número de Afiliación:</label>
  <input type="text" id="numAfiliacion" name="numAfiliacion" required maxlength="20" />

  <label for="fechaAtencion">Fecha de Atención:</label>
  <input type="date" id="fechaAtencion" name="fechaAtencion" required />

  <label for="tipoAfiliacion">Tipo de Afiliación:</label>
  <select id="tipoAfiliacion" name="tipoAfiliacion" required>
    <option value="">-- Seleccione --</option>
    <option value="Contributivo">Contributivo</option>
    <option value="Subsidiado">Subsidiado</option>
    <option value="Particular">Particular</option>
    <option value="Otro">Otro</option>
  </select>

  <label for="codigoDiagnostico">Código Diagnóstico (CIE-10):</label>
  <select id="codigoDiagnostico" name="codigoDiagnostico" required>
    <option value="">-- Seleccione --</option>
    <option value="A00">A00 - Cólera</option>
    <option value="B20">B20 - Infección por VIH</option>
    <option value="E11">E11 - Diabetes tipo 2</option>
  </select>

  <label for="codigoCUPS">Código CUPS:</label>
  <select id="codigoCUPS" name="codigoCUPS" required>
    <option value="">-- Seleccione --</option>
    <option value="101010">101010 - Consulta externa</option>
    <option value="202020">202020 - Procedimiento quirúrgico menor</option>
  </select>

  <label for="cantidad">Cantidad:</label>
  <input type="number" id="cantidad" name="cantidad" required min="1" />

  <label for="valorServicio">Valor del Servicio (COP):</label>
  <input type="number" id="valorServicio" name="valorServicio" required min="0" step="0.01" />

  <label for="observaciones">Observaciones:</label>
  <textarea id="observaciones" name="observaciones" rows="3"></textarea>

  <button type="submit">Agregar Registro</button>
</form>

<button id="exportBtn" style="display:none;">Exportar a CSV</button>
<button id="limpiarBtn" style="display:none;">Limpiar Registros</button>

<div id="mensajeExito">Registro agregado correctamente.</div>

<div id="tablaRegistros">
  <h2>Registros Ingresados</h2>
  <table>
    <thead>
      <tr>
        <th>Tipo ID</th>
        <th>ID Sistema</th>
        <th>Entidad</th>
        <th>Tipo Usuario</th>
        <th>1er Apellido</th>
        <th>2do Apellido</th>
        <th>1er Nombre</th>
        <th>2do Nombre</th>
        <th>Edad</th>
        <th>Unidad Edad</th>
        <th>Sexo</th>
        <th>Departamento</th>
        <th>Municipio</th>
        <th>Zona</th>
        <th>Afiliación</th>
        <th>Fecha Atención</th>
        <th>Afiliación Tipo</th>
        <th>CIE-10</th>
        <th>CUPS</th>
        <th>Cantidad</th>
        <th>Valor</th>
        <th>Observaciones</th>
      </tr>
    </thead>
    <tbody id="tbodyRegistros"></tbody>
  </table>

  <div class="resumen" id="resumenGrupos">
    <strong>Resumen por grupos etarios:</strong>
    <div>0-5 años: <span id="grupo0_5">0</span></div>
    <div>6-12 años: <span id="grupo6_12">0</span></div>
    <div>13-18 años: <span id="grupo13_18">0</span></div>
    <div>19-60 años: <span id="grupo19_60">0</span></div>
    <div>61+ años: <span id="grupo61mas">0</span></div>
  </div>
</div>

<script>
  const registros = [];
  const limpiarBtn = document.getElementById('limpiarBtn');

  function agregarRegistro(data) {
    registros.push(data);
  }

  function actualizarResumenGrupos() {
    let g0_5 = 0, g6_12 = 0, g13_18 = 0, g19_60 = 0, g61mas = 0;

    registros.forEach(reg => {
      let edad = parseInt(reg.edad, 10);
      let unidad = reg.unidadEdad;
      let edadEnAnios = 0;

      if (unidad === "Años") edadEnAnios = edad;
      else if (unidad === "Meses") edadEnAnios = edad / 12;
      else if (unidad === "Días") edadEnAnios = edad / 365;

      if (edadEnAnios >= 0 && edadEnAnios <= 5) g0_5++;
      else if (edadEnAnios > 5 && edadEnAnios <= 12) g6_12++;
      else if (edadEnAnios > 12 && edadEnAnios <= 18) g13_18++;
      else if (edadEnAnios > 18 && edadEnAnios <= 60) g19_60++;
      else if (edadEnAnios > 60) g61mas++;
    });

    document.getElementById("grupo0_5").textContent = g0_5;
    document.getElementById("grupo6_12").textContent = g6_12;
    document.getElementById("grupo13_18").textContent = g13_18;
    document.getElementById("grupo19_60").textContent = g19_60;
    document.getElementById("grupo61mas").textContent = g61mas;
  }

  function actualizarTabla() {
    const tbody = document.getElementById('tbodyRegistros');
    tbody.innerHTML = '';
    registros.forEach(reg => {
      const fila = document.createElement('tr');
      fila.innerHTML = `
        <td>${reg.tipoIdentificacion}</td>
        <td>${reg.numIdSistema}</td>
        <td>${reg.codigoEntidad}</td>
        <td>${reg.tipoUsuario}</td>
        <td>${reg.primerApellido}</td>
        <td>${reg.segundoApellido}</td>
        <td>${reg.primerNombre}</td>
        <td>${reg.segundoNombre}</td>
        <td>${reg.edad}</td>
        <td>${reg.unidadEdad}</td>
        <td>${reg.sexo}</td>
        <td>${reg.codigoDepartamento}</td>
        <td>${reg.codigoMunicipio}</td>
        <td>${reg.zonaResidencia}</td>
        <td>${reg.numAfiliacion}</td>
        <td>${reg.fechaAtencion}</td>
        <td>${reg.tipoAfiliacion}</td>
        <td>${reg.codigoDiagnostico}</td>
        <td>${reg.codigoCUPS}</td>
        <td>${reg.cantidad}</td>
        <td>${parseFloat(reg.valorServicio).toFixed(2)}</td>
        <td>${reg.observaciones || ''}</td>
      `;
      tbody.appendChild(fila);
    });

    const tabla = document.getElementById('tablaRegistros');
    if (registros.length > 0) {
      tabla.style.display = 'block';
      exportBtn.style.display = 'block';
      limpiarBtn.style.display = 'block';
    } else {
      tabla.style.display = 'none';
      exportBtn.style.display = 'none';
      limpiarBtn.style.display = 'none';
    }

    actualizarResumenGrupos();
  }

  function generarReporte(event) {
    event.preventDefault();
    const data = {
      tipoIdentificacion: tipoIdentificacion.value,
      numIdSistema: numIdSistema.value.trim(),
      codigoEntidad: codigoEntidad.value.trim(),
      tipoUsuario: tipoUsuario.value,
      primerApellido: primerApellido.value.trim(),
      segundoApellido: segundoApellido.value.trim(),
      primerNombre: primerNombre.value.trim(),
      segundoNombre: segundoNombre.value.trim(),
      edad: edad.value,
      unidadEdad: unidadEdad.value,
      sexo: sexo.value,
      codigoDepartamento: codigoDepartamento.value.trim(),
      codigoMunicipio: codigoMunicipio.value.trim(),
      zonaResidencia: zonaResidencia.value,
      numAfiliacion: numAfiliacion.value.trim(),
      fechaAtencion: fechaAtencion.value,
      tipoAfiliacion: tipoAfiliacion.value,
      codigoDiagnostico: codigoDiagnostico.value,
      codigoCUPS: codigoCUPS.value,
      cantidad: cantidad.value,
      valorServicio: valorServicio.value,
      observaciones: observaciones.value.trim(),
    };
    agregarRegistro(data);
    actualizarTabla();
    ripsForm.reset();
    mensajeExito.style.display = 'block';
    setTimeout(() => mensajeExito.style.display = 'none', 2000);
  }

  document.getElementById('exportBtn').addEventListener('click', () => {
    if (registros.length === 0) return alert("No hay registros");
    const encabezados = Object.keys(registros[0]);
    const filas = registros.map(r => Object.values(r));
    let csv = [encabezados.join(",")];
    filas.forEach(f => csv.push(f.join(",")));
    const blob = new Blob([csv.join("\n")], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "registros_rips.csv";
    a.click();
    URL.revokeObjectURL(url);
  });

  limpiarBtn.addEventListener('click', () => {
    if (confirm("¿Eliminar todos los registros?")) {
      registros.length = 0;
      actualizarTabla();
    }
  });
</script>

</body>
</html>


